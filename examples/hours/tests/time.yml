kind: test
name: time
spec:
  steps:
    - title: Given 0 hours
      time: 0.0
    - title: Given 2 hours
      time: 2.0
    - title: Given 8 hours
      time: 8.0
    - title: Given 10 hours
      time: 10.0
    - title: Given 40 hours
      time: 40.0
    - title: Given minus 1 hours
      time: -1.0
    - title: Given today
      object:
        date:
          today: {}
    - title: Given that time is added to that project
      steps:
        - When I add that time to that project
        - Then I should have a 201
    - title: When I add that time to that project
      http:
        method: post
        url:
          - @baseUrl
          - /api/projects/
          - @project.id
          - /time
        headers:
          merge:
            - @json
            - @auth
        body:
          id:
            uuid: {}
          time: @time
          package: @package.id
      as: latest
    - title: Given I worked that time on that project
      steps:
        - When I work on that project
        - Then I should have a 201
    - title: When I get the time logged by that user
      http:
        method: get
        url:
          - @baseUrl
          - /api/users/
          - @user.id
          - /time
        headers:
          merge:
            - @json
            - @auth
      as: latest
    - title: When I work that time on that project
      http:
        method: post
        url:
          - @baseUrl
          - /api/time
        headers:
          merge:
            - @json
            - @auth
        body:
          object:
            id:
              uuid: {}
            project: @project.id
            time: @time
            date: @date
            description: Some task
    - title: Then it should have that free time
      expect:
        freeTime: @time
      in: @latest.body
    - title: Then it should have that total time
      expect:
        totalTime: @time
      in: @latest.body
    - title: Then it should have that allocated time
      expect:
        allocatedTime: @time
      in: @latest.body

