kind: test
name: hours
spec:
  include:
    - http
    - store
    - health
    - roles
    - users
    - packages
    - projects
    - assignments
  init:
    baseUrl:
      url: @hours
    auth: {}
    json:
      content-type: application/json
  scenarios:
    - title: Should have a healtcheck
      steps:
        - When I get the health
        - Then I should have a 200
    - title: Should register as employer or employee
      steps:
        - Given the store is empty
        - Given Bob is an employee
        - Given Alice is an employer
        - When I get all users
        - Then I should have a 200
        - Then I should have two items
    - title: Employees should not list users
      steps:
        - Given the store is empty
        - Given Bob is an employee
        - When I get all users
        - Then I should have a 401
    - title: Anonymous clients should not list users
      steps:
        - Given the store is empty
        - When I get all users
        - Then I should have a 401
    - title: Employer shoud create packages
      steps:
        - Given the store is empty
        - Given Alice is an employer
        - Given package 50h
        - When I create that package
        - Then I should have a 409
        - When I get all packages
        - Then I should have a 200
        - Then I should have one item
        - When I get that package
        - Then I should have a 200
    - title: Employees should not create packages
      steps:
        - Given the store is empty
        - Given Bob is an employee
        - Given details for package 50h
        - When I create that package
        - Then I should have a 401
    - title: Anonymous users should not create packages
      steps:
        - Given the store is empty
        - Given Alice is an employer
        - Given details for package 50h
        - Given I am logged out
        - When I create that package
        - Then I should have a 401
    - title: Employer should create projects
      steps:
        - Given the store is empty
        - Given Alice is an employer
        - Given project iot
        - When I create that project
        - Then I should have a 409
        - When I get all projects
        - Then I should have a 200
        - Then I should have one item
        - When I get that project
        - Then I should have a 200
    - title: Employees should not create projects
      steps:
        - Given the store is empty
        - Given Bob is an employee
        - Given details for project iot
        - Given I am logged out
        - When I create that project
        - Then I should have a 401
    - title: Anonymous users should not create projects
      steps:
        - Given the store is empty
        - Given Alice is an employer
        - Given details for project iot
        - Given I am logged out
        - When I create that project
        - Then I should have a 401
    - title: Employer should assign packages to projects
      steps:
        - Given the store is empty
        - Given Alice is an employer
        - Given project iot
        - Given package 50h
        - Given that package is assigned to that project
        - When I assign that package to that project
        - Then I should have a 409
        - When I get all assignments for that project
        - Then I should have a 200
        - Then I should have one item
    - title: Employees should not not assign packages to projects
      steps:
        - Given the store is empty
        - Given Alice is an employer
        - Given project iot
        - Given package 50h
        - Given Bob is an employee
        - When I assign that package to that project
        - Then I should have a 401
    - title: Anonymous users should not assign packages to projects
      steps:
        - Given the store is empty
        - Given Alice is an employer
        - Given project iot
        - Given package 50h
        - Given I am logged out
        - When I assign that package to that project
        - Then I should have a 401
    - title: Employer should assign users to projects
      steps:
        - Given the store is empty
        - Given Bob is an employee
        - Given Alice is an employer
        - Given project iot
        - Given Bob is the current user
        - Given that user is assigned to that project
        - When I assign that user to that project
        - Then I should have a 409
        - When I get all assignments for that project
        - Then I should have a 200
        - Then I should have one item
    - title: Employees should not not assign users to projects
      steps:
        - Given the store is empty
        - Given Alice is an employer
        - Given project iot
        - Given Bob is an employee
        - When I assign that user to that project
        - Then I should have a 401
    - title: Anonymous users should not not assign users to projects
      steps:
        - Given the store is empty
        - Given Alice is an employer
        - Given project iot
        - Given Bob is an employee
        - Given I am logged out
        - When I assign that user to that project
        - Then I should have a 401
