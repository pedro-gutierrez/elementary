kind: module
name: list_users
spec:
  decoders:
    http:
      list:
        any: object
    store:
      memberships:
        memberships:
          list:
            user:
              any: text
            role:
              any: text
  update:
    list:
      cmds:
        store: find_memberships
    memberships:
      model:
        data: @data.memberships
      cmds:
        return: data
  encoders:
    find_memberships:
      store: @store
      find:
        organization: @organization.id
      from: memberships
      as: memberships
