kind: module
name: users
spec:
  decoders:
    http:
      search:
        method: GET
        query:
          email:
            text:
              - downcase
    store:
      users:
        users:
          any: list
  update:
    search:
      model:
        query: @data.query.email
      cmds:
        store: search_by_email
    users:
      model:
        data: @data.users
      cmds:
        return: data
  encoders:
    search_by_email:
      store: @store
      find:
        visibility: public
        email: @query
      from: users
      as: users
