kind: module
name: ui_landing
spec:
  init:
    cmds:
      ui: landing-layout-view
  decoders:
    ui:
      show-landing:
        show: landing
  update:
    show-landing:
      cmds:
        ui: landing-layout-view

  encoders:
    landing-layout-view:
      tag: div
      children:
        - view: container-view
          params:
            content-view: landing-view
            content: "@"
        - view: footer-view
    landing-view:
      tag: section
      attrs:
        class: is-medium section columns
      children:
        - tag: div
          attrs:
            class: column
          children:
            - view: landing-title-view
        - tag: div
          attrs:
            class: column
          children:
            - view: login-view
    landing-title-view:
      view: hero-view
      params:
        icon: fas fa-boxes
        title: Timeboxed
        subtitle: Simple tasks
    login-view:
      view: form-view
      params:
        status: invalid
        message: ""
        fields:
          - name: email
            kind: email
            placeholder: you@domain.com
          - name: password
            kind: password
            placeholder: Your password
          - name: login
            kind: submit
        related:
          - name: forgot-password
            label: Forgot password?
          - name: register
            label: Don't have an account?
    form-view:
      tag: div
      children:
        - tag: div
          attrs:
            class: box
          children:
            - view: form-message-view
              when:
                match:
                  status:
                    other_than: loading
                  message:
                    non_empty: text
            - tag: div
              children:
                loop: "@fields"
                with: form-field-view
                params:
                  status: "@status"
        - tag: div
          children:
            loop: "@related"
            with: internal-link-view
    form-message-view:
      tag: div
      attrs:
        class: 
          format: notification is-{{ style }}
          params:
            style:
              encoder: form-message-style
      children:
        - "@message"
    form-message-style:
      switch: "@status"
      case:
        error: danger
      default: warning
    form-field-view:
      tag: div
      attrs:
        class: field
      children:
        - view:
            format: "form-{{ kind }}-view"
    form-email-view:
      view: form-input-view
    form-password-view:
      view: form-input-view
    form-input-view:
      tag: div
      children:
        - tag: label
          attrs:
            class: label
          children:
            - encoder: form-field-title
        - tag: div
          attrs:
            class: control
          children:
            - tag: input
              attrs:
                let:
                  disabled:
                    encoder: form-input-disabled-style
                in:
                  merge:
                    - "@disabled"
                    - class: input
                      type: "@kind"
                      placeholder: "@placeholder"
    form-field-title:
      either:
        - when:
            has: "@title"
          then: "@title"
        - capitalize: "@name"
    form-submit-view:
      tag: div
      attrs:
        class: control
      children:
        - tag: button
          attrs:
            class: 
              format: button is-link is-{{ status }}
            onclick:
              encoder: form-submit-onclick
          children:
            - encoder: form-field-title
    form-submit-onclick:
      either:
        - when:
            has: onclick
          then: "@onclick"
        - submit: "@name"
    form-input-disabled-style: 
      switch: "@status"
      case:
        loading:
          disabled: ""
      default: {}

