kind: module
name: get_package
spec:
  decoders:
    http:
      get_allocated_time:
        any: object
  update:
    get_allocated_time:
      cmds:
        store: package_allocated_time
    package_allocated_time:
      model:
        data:
          let:
            package: @model.package
            allocatedTime: @data.package_allocated_time.allocatedTime
          in:
            merge:
              - @package
              - allocatedTime: @allocatedTime
                freeTime:
                  diff:
                    - @package.totalTime
                    - @allocatedTime
      cmds:
        return: data
