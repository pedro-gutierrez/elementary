kind: module
name: google_session
spec:
  decoders:
    http:
      create_session:
        params:
          stage: session 
  update:
    create_session:
      model:
        session:
          uuid: {}
      cmds:
        return: authorize
  encoders:
    authorize:
      status: 302
      headers:
        location:
          encoder: google_auth_url
    google_auth_url:
      url:
        scheme: "https"
        host: "accounts.google.com"
        path: "/o/oauth2/v2/auth"
        query:
          client_id: "@client"
          state: "@session"
          scope: "profile email"
          response_type: "code"
          redirect_uri:
            format: "{{ baseUrl }}{{ redirectPath }}"
