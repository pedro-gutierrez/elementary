kind: module
name: packages
spec:
  decoders:
    http:
      create:
        method: POST
        body:
          id:
            any: text
          name:
            any: text
          time:
            any: number
          rate:
            any: number
      get:
        method: GET
    store:
      packages:
        packages:
          any: list
  update:
    create:
      model:
        package: @data.body
      cmds:
        store: create
    get:
      cmds:
        store: list
    packages:
      model:
        data: @data.packages
      cmds:
        return: data
  encoders:
    create:
      store: @store
      insert:
        merge:
          - @package
          - created:
              now: {}
            timeLeft: @package.time
      into: packages
    list:
      store: @store
      find: {}
      from: packages
      as: packages

