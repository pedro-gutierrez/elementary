kind: module
name: user
spec:
  decoders:
    http:
      my_profile:
        params:
          id: @user.id
      public_profiles:
        params:
          id:
            other_than: @user.id
    store:
      user:
        user:
          any: object
      not_found:
        user: not_found
  update:
    my_profile:
      model:
        query:
          id: @data.params.id
      cmds:
        store: fetch
    public_profiles:
      model:
        query:
          id: @data.params.id
          visibility: public
      cmds:
        store: fetch
    user:
      model:
        data: @data.user
      cmds:
        return: data
    not_found:
      cmds:
        return: unauthorized
  encoders:
    fetch:
      store: @store
      fetch: @query
      from: users
      as: user
