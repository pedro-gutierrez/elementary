kind: module
name: common_organization
spec:
  decoders:
    store:
      organization:
        organization:
          any: object
  encoders:
    find_organization:
      store: @store
      fetch:
        id: @organization
      from: organizations
      as: organization
    is_organization_owner:
      equal:
        - @model.organization.owner
        - @model.user.id
    is_organization_member:
      match: @model.user_memberships
      with:
        list:
          with:
            organization: @model.organization.id
            user: @model.user.id
    is_public:
      equal:
        - @model.organization.visibility
        - public
