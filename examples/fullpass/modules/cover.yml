kind: module
name: cover
spec:
  decoders:
    http:
      upload:
        method: POST
        params:
          id:
            any: text
        body:
          any: data
      download:
        method: GET
        params:
          id:
            any: text
    store:
      uploaded:
        status: created
      downloaded:
        cover:
          id:
            any: text
          original:
            any: data
      not_found:
        status: not_found
  update:
    upload:
      model:
        id: @data.params.id
        data: @data.body
      cmds:
        store: upload
    download:
      model:
        id: @data.params.id
      cmds:
        store: download
    uploaded:
      cmds:
        return: created
    downloaded:
      model:
        cover: @data.cover.original
      cmds:
        return: cover
    not_found:
      cmds:
        return: not_found
  encoders:
    upload:
      store: @store
      insert:
        id: @id
        original: @data
      into: covers
    download:
      store: @store
      fetch:
        id: @id
      from: covers
      as: cover
    cover:
      status: 200
      headers: {}
      body: @cover

