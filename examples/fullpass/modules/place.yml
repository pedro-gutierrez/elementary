kind: module
name: place
spec:
  decoders:
    http:
      fetch:
        method: GET
        params:
          id:
            any: text
    store:
      not_found:
        status: not_found
      found:
        place:
          any: object
  update:
    fetch:
      model:
        id: @data.params.id
      cmds:
        store: fetch
    found:
      model:
        let:
          place: @data.place
        in:
          place:
            id: @place.id
            name: @place.name
            lat:
              first: @place.location.coordinates
            lon:
              last: @place.location.coordinates
      cmds:
        return: place
    not_found:
      cmds:
        return: not_found
  encoders:
    fetch:
      store: @store
      fetch:
        id: @id
      from: places
      as: place
    place:
      status: 200
      headers:
        content-type: application/json
      body: @place
