kind: module
name: places
spec:
  decoders:
    http:
      create:
        method: POST
        headers:
          content-type: application/json
        body:
          id:
            any: text
          name:
            any: text
          lat:
            any: number
          lon:
            any: number
    store:
      created:
        status: created
      conflict:
        status: conflict
  update:
    create:
      model:
        place:
          id: @body.id
          name: @body.name
          location:
            type: Point
            coordinates:
              - @body.lon
              - @body.lat
      cmds:
        store: create
    conflict:
      cmds:
        return: conflict
    created:
      cmds:
        return: created
  encoders:
    create:
      store: @store
      insert: @place
      into: places
