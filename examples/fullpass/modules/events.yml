kind: module
name: events
spec:
  decoders:
    http:
      list:
        method: GET
      create:
        method: POST
        headers:
          content-type: application/json
        body:
          id:
            any: text
          name:
            any: text
          venue:
            any: text
          date:
            any: date
    store:
      created:
        status: created
      conflict:
        status: conflict
      not_found:
        status: not_found
      venue:
        venue:
          any: object
      events:
        items:
          any: list
  update:
    list:
      cmds:
        store: list
    create:
      model:
        event: @body
      cmds:
        store: find_venue
    venue:
      cmds:
        store: create
    conflict:
      cmds:
        return: conflict
    created:
      cmds:
        return: created
    events:
      model:
        events: @items
      cmds:
        return: events
    not_found:
      cmds:
        return: not_found
  encoders:
    find_venue:
      store: @store
      fetch:
        id: @event.venue
      from: venues
      as: venue
    create:
      store: @store
      insert: @event
      into: events
    list:
      store: @store
      from: events
    events:
      status: 200
      headers:
        content-type: application/json
      body: @events
