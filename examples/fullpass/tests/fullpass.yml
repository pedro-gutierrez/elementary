kind: test
name: fullpass
spec:
  include:
    - health
    - http
    - store
    - users
    - password
    - places
    - events
    - login
    - passes
    - offers
    - demands
  init:
    baseUrl:
      url: @fullpass
  scenarios:
    - title: Should have a healtcheck
      steps:
        - When I get the health
        - Then I should have a 200
    - title: Should register new users
      steps:
        - Given the store is empty
        - Given user Alice
        - When I register
        - Then I should have a 409
    - title: Should reset passwords
      steps:
        - Given the store is empty
        - Given user Alice
        - Given I resetted my password
        - When I reset my password
        - Then I should have a 401
    - title: Should log in
      steps:
        - Given the store is empty
        - Given user Alice
        - Given I resetted my password
        - Given I am logged in
    - title: Should reject wrong logins
      steps:
        - Given the store is empty
        - Given user Alice
        - Given I resetted my password
        - Given password bar
        - When I log in
        - Then I should have a 401
        - Given details for Bob
        - When I log in
        - Then I should have a 401
    - title: Should log out
      steps:
        - Given the store is empty
        - Given user Alice
        - Given I resetted my password
        - Given I am logged in
        - When I log out
        - Then I should have a 200
        - When I log out
        - Then I should have a 401
    - title: Should create places
      steps:
        - Given the store is empty
        - Given user Alice
        - Given I resetted my password
        - Given I am logged in
        - Given the Amaragua
        - When I create that place
        - Then I should have a 409
    - title: Should get places by id
      steps:
        - Given the store is empty
        - Given user Alice
        - Given I resetted my password
        - Given I am logged in
        - Given the Amaragua
        - When I get that place
        - Then I should have that place
        - Given a fake place
        - When I get that place
        - Then I should have a 404
    - title: Should create events
      steps:
        - Given the store is empty
        - Given user Alice
        - Given I resetted my password
        - Given I am logged in
        - Given the Amaragua
        - Given the Afrofestival
        - When I create that event
        - Then I should have a 409
        - Given a fake place
        - Given details for the Afrofestival
        - When I create that event
        - Then I should have a 404
    - title: Should not accept events with an invalid date
      steps:
        - Given the store is empty
        - Given user Alice
        - Given I resetted my password
        - Given I am logged in
        - Given the Amaragua
        - Given details for the Afrofestival
        - Given new, invalid dates for that event
        - When I create that event
        - Then I should have a 400
    - title: Should get events by id
      steps:
        - Given the store is empty
        - Given user Alice
        - Given I resetted my password
        - Given I am logged in
        - Given the Amaragua
        - Given the Afrofestival
        - When I get that event
        - Then I should have that event
        - Given a fake event
        - When I get that event
        - Then I should have a 404
    - title: Should upload covers
      steps:
        - Given the store is empty
        - Given user Alice
        - Given I resetted my password
        - Given I am logged in
        - Given the Amaragua
        - Given the Afrofestival
        - Given a cover
        - When I set that event cover
        - Then I should have a 201
        - When I get that event cover
        - Then I should have a 200
    - title: Should find events nearby
      steps:
        - Given the store is empty
        - Given user Alice
        - Given I resetted my password
        - Given I am logged in
        - Given the Amaragua
        - Given the Afrofestival
        - Given the Auditorium
        - Given the Feeling Festival
        - Given I am in Torremolinos
        - When I look for events nearby
        - Then I should have a 200
        - Then I should have one item
        - Given details for the Afrofestival
        - Then that event should match that item
        - Given I am in Madrid
        - When I look for events nearby
        - Then I should have a 200
        - Then I should have one item
        - Given details for the Feeling Festival
        - Then that event should match that item
    - title: Should return events for a given month
      steps:
        - Given the store is empty
        - Given user Alice
        - Given I resetted my password
        - Given I am logged in
        - Given the Amaragua
        - Given the Afrofestival
        - Given the Auditorium
        - Given the Feeling Festival
        - Given next month
        - When I look for events for that month
        - Then I should have one item
        - Given details for the Afrofestival
        - Then that event should match that item
        - Given in two months
        - When I look for events for that month
        - Then I should have one item
        - Given details for the Feeling Festival
        - Then that event should match that item
    - title: Should reschedule events
      steps:
        - Given the store is empty
        - Given user Alice
        - Given I resetted my password
        - Given I am logged in
        - Given the Amaragua
        - Given the Afrofestival
        - Given next month
        - When I reschedule that event
        - Then I should have a 200
    - title: Only the owner should update events
      steps:
        - Given the store is empty
        - Given user Alice
        - Given I resetted my password
        - Given I am logged in
        - Given the Amaragua
        - Given the Afrofestival
        - Given next month
        - Given user Bob
        - Given I resetted my password
        - Given I am logged in
        - When I reschedule that event
        - Then I should have a 401
    - title: Should create a fullpass
      steps:
        - Given the store is empty
        - Given user Alice
        - Given I resetted my password
        - Given I am logged in
        - Given the Amaragua
        - Given the Afrofestival
        - Given a lady full pass
    - title: Should find all passes for a single event
      steps:
        - Given the store is empty
        - Given user Alice
        - Given I resetted my password
        - Given I am logged in
        - Given the Amaragua
        - Given the Afrofestival
        - Given a lady full pass
        - When I get all passes for that event
        - Then I should have a 200
        - Then I should have one item
    - title: Should offer passes
      steps:
        - Given the store is empty
        - Given user Alice
        - Given I resetted my password
        - Given I am logged in
        - Given the Amaragua
        - Given the Afrofestival
        - Given a lady full pass
        - Given 50 euros
        - Given next month
        - Given I offered that pass
        - Given 65 euros
        - Given in two months
        - Given I offered that pass
        - Given user Bob
        - Given I resetted my password
        - Given I am logged in
        - When I offer that pass
        - Then I should have a 401
    - title: Should withdraw offers
      steps:
        - Given the store is empty
        - Given user Alice
        - Given I resetted my password
        - Given I am logged in
        - Given the Amaragua
        - Given the Afrofestival
        - Given a lady full pass
        - Given 50 euros
        - Given next month
        - Given I offered that pass
        - When I withdraw that offer
        - Then I should have a 200
    - title: Should not withdraw others offers
      steps:
        - Given the store is empty
        - Given user Alice
        - Given I resetted my password
        - Given I am logged in
        - Given the Amaragua
        - Given the Afrofestival
        - Given a lady full pass
        - Given 50 euros
        - Given next month
        - Given I offered that pass
        - Given user Bob
        - Given I resetted my password
        - Given I am logged in
        - When I withdraw that offer
        - Then I should have a 401
    - title: Should return owned offers
      tags:
        - debug
      steps:
        - Given the store is empty
        - Given user Alice
        - Given I resetted my password
        - Given I am logged in
        - Given the Amaragua
        - Given the Afrofestival
        - Given a lady full pass
        - Given 50 euros
        - Given next month
        - Given I offered that pass
        - Given a men full pass
        - Given 40 euros
        - Given next month
        - Given I offered that pass
        - When I get my offers
        - Then I should have a 200
        - Then I should have two items
    - title: Should demand passes
      steps:
        - Given the store is empty
        - Given user Alice
        - Given I resetted my password
        - Given I am logged in
        - Given the Amaragua
        - Given the Afrofestival
        - Given a lady full pass
        - Given I demand that pass
        - When I demand that pass
        - Then I should have a 200
    - title: Should withdraw demands
      steps:
        - Given the store is empty
        - Given user Alice
        - Given I resetted my password
        - Given I am logged in
        - Given the Amaragua
        - Given the Afrofestival
        - Given a lady full pass
        - Given I demand that pass
        - When I withdraw that demand
        - Then I should have a 200
    - title: Should not withdraw others demands
      steps:
        - Given the store is empty
        - Given user Alice
        - Given I resetted my password
        - Given I am logged in
        - Given the Amaragua
        - Given the Afrofestival
        - Given a lady full pass
        - Given I demand that pass
        - Given user Bob
        - Given I resetted my password
        - Given I am logged in
        - When I withdraw that demand
        - Then I should have a 401
