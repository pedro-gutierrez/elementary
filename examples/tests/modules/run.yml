kind: module
name: run
spec:
  decoders:
    http:
      run:
        method: POST
        params:
          test:
            any: text
          settings:
            any: text
    test:
      running:
        status: running
      error:
        status:
          other_than: running
        reason:
          any: text
  update:
    run:
      model: @params
      cmds:
        test: test
    running:
      cmds:
        response: running
    error:
      model:
        error:
          status: @status
          reason: @reason
      cmds:
        response: error
  encoders:
    test:
      run: @
    running:
      status: 201
      headers:
        content-type: application/json
      body:
        status: running
    error:
      status:
        encoder: status
      headers:
        content-type: application/json
      body: @error
    status:
      choose: @error.status
      when:
        not_found: 404
      otherwise: 500
