kind: module
name: ui_common
spec:
  decoders:
    http:
      not_found:
        status: 404
  update:
    not_found:
      model:
        view: not-found-view
      cmds:
        ui: public-layout-view
  encoders:
    layout-view:
      tag: div
      attrs:
        class:
          format: "{{ bg-color }} {{ fg-color }}"
          params:
            encoder: theme-colors
      children:
        - view: header-view
          params:
            view: "@view"
            nav: "@nav"
        - tag: div
          attrs:
            class: container mx-auto flex flex-col py-12 justify-center items-center
          children:
             - view: "@view"
        - view: footer-view
          params:
            content-view:
              maybe: "@footer"
    empty-layout-view:
      tag: div
      attrs:
        class:
          format: "{{ bg-color }} {{ fg-color }}"
          params:
            encoder: theme-colors
      children:
        - tag: div
          attrs:
            class: container mx-auto flex flex-col py-24 justify-center items-center
          children:
             - view: "@view"
    home-link:
      active-view: home-view
      route: []
      title:
        encoder: i18n
        params:
          en: Home
          es: Inicio
          fr: Accueil
    login-link:
      route: login 
      title:
        encoder: i18n
        params:
          en: Login
          es: Abrir sesión
          fr: Se connecter
    public-layout-view:
      view: layout-view
      params:
        nav:
          - encoder: home-link
          - content-view: theme-switcher-view
          - content-view: display-mode-switcher-view
        footer: mailing-list-form-view
    member-layout-view:
      view: layout-view
      params:
        nav:
          concat:
            - encoder: apps-nav
            - content-view: theme-switcher-view
            - content-view: display-mode-switcher-view
    loading-view:
      view: hero-view
      params:
        title: Loading
        title-size: text-xl
        icon: fas fa-hourglass-start
        icon-size: fa-4x
    footer-view:
      tag: footer
      attrs:
        class:
          format: "{{ fg-color }} {{ bg-color }} body-font"
          params:
            encoder: theme-colors
      children:
        - view: 
            maybe: "@footer"
        - tag: div
          attrs:
            class:
              format: "{{ bg-color-active }}"
              params:
                encoder: theme-colors
          children:
            - tag: div
              attrs:
                class: container mx-auto py-4 px-5 flex flex-wrap flex-col sm:flex-row
              children:
                - tag: p
                  attrs:
                    class: text-gray-500 text-sm text-center sm:text-left
                  children:
                    - view: icon-view
                      params:
                        icon: fa fa-skull-crossbones
                        margin: mx-1
                        title: "Skull"
                    - "© 2020 Codemutiny"
    header-view:
      tag: header
      attrs:
        class:
          format: "{{ fg-color }} {{ bg-color }} body-font"
          params:
            encoder: theme-colors
      children:
        - tag: div
          attrs:
            class: container mx-auto flex flex-wrap p-5 flex-col md:flex-row items-center
          children:
            - tag: a
              attrs:
                class:
                  format: "flex title-font font-medium items-center mb-4 md:mb-0 {{ fg-color }}"
                  params:
                    encoder: theme-colors
              children:
                - view: icon-view
                  params:
                    size: text-xl
                    icon: fa fa-skull-crossbones
                - tag: span
                  attrs:
                    class: ml-3 text-xl
                  children:
                    - Codemutiny
            - tag: nav
              attrs:
                class: md:ml-auto flex flex-wrap items-center text-base justify-center
              children:
                loop: "@nav"
                with: header-nav-item-view
    header-nav-item-view:
      view:
        maybe: "@content-view"
        otherwise: header-link-view
    header-link-view:
      tag: a
      attrs:
        href: "#"
        class:
          format: "mr-5 hover:{{ fg-hover }} {{ extra }} {{ bg-color-active }} hover:{{ bg-color-active-hover }}"
          params:
            merge:
              - encoder: theme-colors
              - choose: "@view"
                when: "@active-view"
                then:
                  fg-hover: none
                  extra: "border-0 py-1 px-3 focus:outline-none rounded text-base"
                otherwise:
                  extra: ""
                  bg-color-active: none
                  bg-color-active-hover: none
        onclick:
          navigate:
            encoder: encode-route
      children:
        - capitalize: 
            maybe: "@title"
            otherwise: "@route"
    hero-view:
      tag: section
      attrs:
        class: text-gray-700 body-font w-full text-center py-24
      children:
        - tag: div
          attrs:
            class: container mx-auto
          children:
            - tag: div
              children:
                - view: icon-view
                  params:
                    margin: mx-4 mb-2
                    size: 
                      maybe: "@icon-size"
                      otherwise: fa-10x
                    icon: "@icon"
            - tag: h1
              attrs:
                class: 
                  format: "{{ fg-color}} title-font {{ title-size }} mb-4 font-medium"
                  params:
                    merge:
                      - title-size:
                          maybe: "@title-size"
                          otherwise: text-5xl 
                      - encoder: theme-colors
              children:
                - "@title"
    icon-view:
      tag: i
      attrs:
        title:
          maybe: "@title"
        class:
          format: "{{ icon }} {{ margin }} {{ color }} {{ size }}"
    not-found-view:
      tag: div
      children:
        - "The page you are trying to reach could not be found"
    text-field-view:
      tag: input
      attrs:
        class:
          format: "{{ input-bg-color }} rounded border {{ input-border-color }} {{ input-fg-color }} focus:outline-none focus:border-{{ theme }}-500 text-base py-2 px-4 mb-4"
          params:
            merge:
              - theme: "@theme"
              - encoder: theme-colors
        placeholder: "@params.placeholder"
        oninput:
          format: "{{ app }}-{{ feature }}-{{ field }}"
          params:
            app: "@app"
            feature: "@feature"
            field: "@params.name"
        type: text
      children: []
    form-view:
      tag: div
      attrs:
        class: 
          format: "{{ &width }} {{ bg-color-active-2 }} rounded-lg p-6 flex flex-col md:ml-auto w-full mt-10 md:mt-0"
          params:
            merge:
              - encoder: theme-colors 
              - width:
                  maybe: "@width"
                  otherwise: w-full 
      children:
        - tag: h2
          attrs:
            class: 
              format: "{{ fg-color-active-2 }} text-xl mb-4 font-medium"
              params:
                encoder: theme-colors
          children:
            - view: icon-view
              params:
                margin: mr-2
                icon: "@icon"
            - encoder: i18n
              params: "@title"
        - tag: p
          attrs:
            class: "leading-relaxed mb-5 {{ fg-color }}"
            params:
              encoder: theme-colors
          children:
            - encoder: i18n
              params: "@subtitle"
        - tag: div
          attrs:
            class: w-full flex flex-col
          children:
            loop: "@fields"
            with: "@view"
        - tag: button
          attrs:
            class:
              format: "text-white bg-{{ theme }}-500 border-0 py-2 px-6 focus:outline-none hover:bg-{{ theme }}-600 rounded {{ disabled }}"
              params:
                theme: "@theme"
                disabled:
                  switch: "@loading"
                  case:
                    true: "cursor-not-allowed"
                  default: ""
            onclick:
              switch: "@loading"
              case:
                true: noop
              default: 
                format: "{{ app }}-{{ feature }}-{{ event }}"
                params:
                  app: "@app"
                  feature: "@feature"
                  event: 
                    maybe: "@action.event"
                    otherwise: "submit"
          children:
            - encoder: i18n
              params: "@action.title"
            - view: icon-view
              when: 
                maybe: "@loading"
                otherwise: false
              params:
                margin: mx-1
                icon: fa fa-spinner fa-spin
        - tag: p
          when:
            is_set: "@message"
          attrs:
            class:
              format: "text-xs mt-3 {{ fg-color }}"
          children:
            - "@message"