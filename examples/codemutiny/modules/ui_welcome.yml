kind: module
name: ui_welcome
spec:
  decoders:
    http:
      unauthorized:
        status: 401
      profile:
        body:
          email:
            any: text
          id:
            any: text
          name:
            any: text
          picture:
            any: text
  update:
    welcome-page:
      model:
        view: loading-view
        session: "@data.query.session"
        memberView: welcome-view
        onProfile:
          ui: {}
      cmds:
        http: get-profile
        ui: layout-view
    unauthorized:
      model:
        session: ""
        view: unauthorized-view
      cmds:
        ui: {}
    profile:
      model:
        profile: "@data.body"
        view: member-layout-view
      cmds: "@onProfile"
  encoders:
    get-profile:
      method: get
      path: /api/profile
      headers:
        authorization: "@session"
    welcome-view:
      tag: h1
      children:
        - Hello !
    member-layout-view:
      tag: div
      children:
        - view: member-nav-view
        - view: "@memberView"
    member-nav-view:
      view: navbar-view
      params:
        session: "@session"
        profile: "@profile"
        menu:
          - route: subscriptions
            icon: fas fa-shopping-cart
          - route: logout
            icon: fas fa-power-off

    navbar-view:
      tag: nav
      attrs:
        class: navbar is-transparent is-fixed-top is-spaced
        role: navigation
        aria-label: main navigation
      children:
        - tag: div
          attrs:
            class: navbar-brand
          children:
            - tag: a
              attrs:
                role: button
                class: navbar-burger
                aria-label: menu
                aria-expanded: false
              children:
                - view: burger-span
                - view: burger-span
                - view: burger-span
        - tag: div
          attrs:
            class: navbar-menu
          children:
            - tag: div
              attrs:
                class: navbar-start
              children: []
            - tag: div
              attrs:
                class: navbar-end
              children:
                loop: "@menu"
                with: navbar-item-view
    burger-span:
      tag: span
      attrs:
        aria-hidden: true
      children: []
    welcome-view:
      tag: div
      children:
        - tag: h1
          children:
            - format: "Welcome {{name}}"
              params:
                name: "@profile.name"
        - view: avatar-view
          params:
            url: "@profile.picture"
        - view: user-menu-view
    avatar-view:
      tag: figure
      attrs:
        style:
          margin-right: 5px
        class: 
          format: "image is-{{size}}x{{size}}"
      children:
        - tag: img
          attrs:
            class: is-rounded
            src: "@url"
    navbar-item-view:
      tag: div
      attrs:
        class: navbar-item
      children:
        - tag: a
          attrs:
            class: is-light button
            onclick:
              navigate:
                format: "{{ route}}?session={{ session }}"
          children:
            - view: icon-view
            - tag: span
              children:
                - capitalize: "@route"  
