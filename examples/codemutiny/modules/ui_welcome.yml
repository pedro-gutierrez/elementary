kind: module
name: ui_welcome
spec:
  decoders:
    http:
      unauthorized:
        status: 401
      profile:
        body:
          email:
            any: text
          id:
            any: text
          name:
            any: text
          picture:
            any: text
  update:
    welcome-page:
      model:
        view: loading-view
        session: "@data.query.session"
      cmds:
        http: get-profile
        ui: layout-view
    unauthorized:
      model:
        session: ""
        view: unauthorized-view
      cmds:
        ui: {}
    profile:
      model:
        profile: "@data.body"
        view: member-layout-view
        member-view: welcome-view
      cmds:
        ui: {}
  encoders:
    get-profile:
      method: get
      path: /api/profile
      headers:
        authorization: "@session"
    member-layout-view:
      tag: div
      children:
        - view: member-nav-view
          #    - view: "@member-view"
    member-nav-view:
      view: navbar-view
      params:
        profile: "@profile"
        menu:
          - icon: fas fa-shopping-cart
            route: subscriptions
    navbar-view:
      tag: nav
      attrs:
        class: navbar is-transparent is-fixed-top is-spaced
        role: navigation
        aria-label: main navigation
      children:
        - tag: div
          attrs:
            class: navbar-brand
          children:
            - tag: a
              attrs:
                role: button
                class: navbar-burger
                aria-label: menu
                aria-expanded: false
              children:
                - view: burger-span
                - view: burger-span
                - view: burger-span
        - tag: div
          attrs:
            class: navbar-menu
          children:
            - tag: div
              attrs:
                class: navbar-start
              children: []
            - tag: div
              attrs:
                class: navbar-end
              children:
                - tag: div
                  attrs:
                    class: navbar-item has-dropdown is-active
                  children:
                    - tag: a
                      attrs:
                        class: button is-light
                      children:
                        - view: avatar-view
                          params:
                            size: 24
                            url: "@profile.picture"
                            #- "@profile.name"
                    - tag: div
                      attrs:
                        class: navbar-dropdown is-right
                      children:
                        loop: "@menu"
                        with: user-menu-link 
    burger-span:
      tag: span
      attrs:
        aria-hidden: true
      children: []
    welcome-view:
      tag: div
      children:
        - tag: h1
          children:
            - format: "Welcome {{name}}"
              params:
                name: "@profile.name"
        - view: avatar-view
          params:
            url: "@profile.picture"
        - view: user-menu-view
    avatar-view:
      tag: figure
      attrs:
        style:
          margin-right: 5px
        class: 
          format: "image is-{{size}}x{{size}}"
      children:
        - tag: img
          attrs:
            class: is-rounded
            src: "@url"
    user-menu-link:
      tag: a
      attrs:
        class: button is-light
        onclick:
          navigate: "@route"
      children:
        #        - view: icon-view
        - capitalize: "@route"
