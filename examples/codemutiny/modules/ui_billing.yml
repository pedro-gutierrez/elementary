kind: module
name: ui_billing
spec:
  init:
    model:
      products: []
  decoders:
    router:
      show-subscriptions:
        path: /subscriptions
        query:
          session:
            any: text
    http:
      products:
        products:
          body:
            any: list
  update:
    show-subscriptions:
      model:
        session: "@data.query.session"
        view: loading-view
        memberView: subscriptions-view
        onProfile:
          http: get-products
      cmds:
        http: get-profile
        ui: layout-view
    products:
      model:
        view: member-layout-view
        products: "@data.products.body"
      cmds:
        ui: {}
  encoders:
    subscriptions-view:
      tag: div
      children:
        - subscriptions
        - view: products-view
    products-view:
      tag: div
      children:
        loop: "@products"
        with: product-view
    product-view:
      tag: div
      children:
        loop: "@plans"
        with: plan-view
    plan-view:
      tag: div
      children:
        - "@name"
    get-products:
      method: get
      path: /api/billing/products
      as: products
