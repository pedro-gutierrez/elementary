kind: module
name: ui_app
spec:
  decoders:
    events:
      subscribed-products-ready:
        subscribed-products:
          any: list
    router:
      show-app:
        route:
          - apps
          - any: text
        query:
          session:
            any: text
  update:
    show-app:
      model:
        app:
          last: "@data.route" 
        session: "@data.query.session"
      cmds:
        events: show-member-home-page
    subscribed-products-ready:
      model:
        view: 
          encoder: member-first-view
      cmds:
        ui: member-layout-view
  encoders:
    app-view:
      format: "{{ name }}-app-view"
    apps-nav:
      map: "@subscribed-products"
      with:
        active-view:
          encoder: "app-view"
          params: "@item"
        route: 
          - apps
          - "@item.name"
        title: "@item.name"
    member-first-view:
      encoder: app-view
      params:
        name: 
          maybe: "@app"
          otherwise:
            let:
              product: 
                head: "@model.subscribed-products"
            in: "@product.name"