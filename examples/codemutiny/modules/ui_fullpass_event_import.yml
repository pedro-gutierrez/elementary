kind: module
name: ui_fullpass_event_import
spec:
  init:
    model:
      fp-event-url: ""
      message: ""
      loading: false
  decoders:
    ui:
      fp-event-import-url:
        fp-event-import-url:
          any: text
      fp-event-import-submit:
        fp-event-import-submit:
          any: text
    http:
      fp-event-import-error:
        fp-event-import:
          status:
            other_than: 202
      fp-event-import-success:
        fp-event-import:
          status: 202
  update:
    fp-event-import-url:
      model:
        fp-event-url: "@data.fp-event-import-url"
      cmds:
        ui: {}
    fp-event-import-submit:
      model: 
        fullpass-event:
          source: facebook
          id: 
            last:
              split: "@model.fp-event-url"
              using: "/"
        loading: true
      cmds:
        http: fp-event-import
        ui: {}
    fp-event-import-error:
      model:
        message:
          encoder: app-error
        loading: false 
      cmds:
        ui: {}
    fp-event-import-success:
      model:
        view: fp-event-imported-view
        loading: false 
      cmds:
        ui: {}
  encoders:
    fp-event-import: 
      method: post 
      path: /api/fullpass/events
      headers:
        content-type: application/json
        authorization: "@session"
      body: "@fullpass-event"
      as: fp-event-import
    fp-event-imported-view:
      view: notification-view
      params:
        message:
          encoder: i18n
          params:
            en: "Your event has been received. We are now verifying it."
            fr: "Votre évènement es en cours de vérification"
            es: "Hemos recibido tu evento, y lo estamos verificando"
    fp-event-import-view:
      view: form-view
      params:
        loading: "@loading"
        title: "@title"
        subtitle:
          en: Send us the address of the event so that we can verify it 
          fr: Envoyez nous l'addresse de l'évènement, afin que nous puissons le vérifer 
          es: Envíanos la dirección del evento para que podamos verificarlo
        message: "@message"
        fields:
          - view: text-field-view
            params:
              name: "url"
              value: "@fp-event-url"
              placeholder:  https://www.facebook.com/events/2461820943882154
        action:
          title:
            en: Send 
            fr: Envoyer 
            es: Enviar 